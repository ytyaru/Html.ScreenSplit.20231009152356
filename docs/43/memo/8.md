# リビジョン管理

　本のリビジョン管理をしたい。普通はGitHubを使うが、Client側のJavaScriptだけで完結したい。

　アルゴリズムはLinuxコマンドの`diff`と`patch`を使う。

* https://mrgoofy.hatenablog.com/entry/20101019/1287500809
* https://github.com/google/diff-match-patch

# diff & patch

```sh
echo -e "1.Perl\n2.Java\n3.PHP\n4.Ruby\n5.SQL" > v1.txt
echo -e "1.Perl\n2.C++\n3.PHP\n4.Ruby\n5.SQL\n6.JavaScript" > v2.txt
diff -u v1.txt v2.txt > v1-2.patch
patch -u v1.txt < v1-2.patch
patch -uR v1.txt < v1-2.patch
patch -uR v2.txt < v1-2.patch
patch -u v2.txt < v1-2.patch
```

## 1

　v1,v2という微妙に異なるテキストファイルを作成する。

```sh
echo -e "1.Perl\n2.Java\n3.PHP\n4.Ruby\n5.SQL" > v1.txt
echo -e "1.Perl\n2.C++\n3.PHP\n4.Ruby\n5.SQL\n6.JavaScript" > v2.txt
```

　この段階で差分を取ると以下のような差異があるとわかる。

```sh
$ diff v1.txt v2.txt
2c2
< 2.Java
---
> 2.C++
5a6
> 6.JavaScript
```

## 2

　v1,v2の差分を取得し、patchファイルとして保存する。

```sh
diff -u v1.txt v2.txt > v1-2.patch
```

　v1にpatchを当ててv2に変更する。

```sh
patch -u v1.txt < v1-2.patch
```

　v1とv2の差分を取ると何も表示されない。つまり完全一致した同一内容である。このようにpatchファイルを当てることで別バージョンに修正できる。

```sh
$ diff v1.txt v2.txt

```

## 3

　バージョンを戻すこともできる。`R`フラグを付与する。

```sh
patch -uR v1.txt < v1-2.patch
```

　差分を取ると次のようになる。最初の時と同じ状態に戻った。

```sh
$ diff v1.txt v2.txt
2c2
< 2.Java
---
> 2.C++
5a6
> 6.JavaScript
```

## 4

　v2のほうにpatchを当てても同じことができる。ただし`R`フラグは逆になる。

```sh
patch -uR v2.txt < v1-2.patch
```

　差分を取ると完全一致になった。ようはv2の内容がv1と同じになった。

```sh
$ diff v1.txt v2.txt

```

# 小説におけるリビジョン管理

* 追記
* 削除
* 修正

　主に修正についてリビジョン管理する。想定しているのは公開後、読者に指摘され発覚した誤字脱字の修正。

* 誤記・タイポ・書き損じ・書き誤り（誤字・脱字・衍字《えんじ》）
* 誤用（誤った用法をすること。諺や慣用句を用いるとき、誤った意味で使われる場合がそれ）
* 誤謬《ごびゅう》（知識や考え、論理の誤り）

　誤記はいわゆる誤字・脱字・衍字のこと。表記ミスでありタイプミス。意味を理解せずともミスであることが一目瞭然なので発見しやすい。

　誤用は用法の誤り。「敷居が高い」という言葉は本来、不義理を働いてしまった人の家に行きづらい気持ちを指します。ところが後に、格式が高い家や店に入りにくいという意味で使われ、ついに広辞苑にも意味が追加された。このように言葉の意味は時代とともに変わるため、誤記よりも指摘がやや難しい。

　誤謬は論理の誤り。たとえば「人は戦争する、戦争は人を殺す、私は人である。よって私は人殺しだ」という三段論法による結論。これは誤謬だ。私は人類の一個体であるが、直接人を殺したことはないし、殺人罪に問われたこともない。「早まった一般化」という認知的誤謬の一種である。（ただし間接的な殺人は否定できない。たとえば現代社会生活をするせいで地球温暖化により不作になり食糧難になって間接的に誰かを餓死させている等。その場合でも法的な殺人の定義とは異なるため無罪だが、人を間接的に殺している点については否定できない）
　誤謬があったとしても作品上わざとそうしている場合もある。ただしシリアス作品で主人公が生死をかけた場面で誤謬しているのは指摘すべき。とくに誤謬があるのにその後の展開で成功しているとご都合主義に見えて白けてしまう。誤謬の指摘は文脈をみて判断する必要があるため、誤記、誤用よりも指摘が難しい。

　ガッツリ加筆するのは想定外。不可能ではないが、メタデータのテキスト量が膨大になってしまう。別ファイルにするほうが自然。

# 実装

* https://github.com/google/diff-match-patch

　たぶんこれでなんとかなる。

